# Проблемы

- Потеря заказов между CRM и MES.
- Проблема с поиском заказов по базе данных MES.
- Медленные расчеты стоимости в MES (обычно 2-3 мин, до 30 мин в сложных случаях).
- CRM и онлайн-магазин используют общую базу данных ShopDB.

# Инициативы

1. Работы по улучшению наблюдаемости системы: внедрение метрик в каждую из подсистем: онлайн-магазин, CRM, MES, используемые базы и очередь сообщений; трейсинг запросов.

2. Выделение расчетов стоимости заказа по 3D модели в отдельный микросервис. Выглядит перспективным направлением, т.к. даст возможность горизонтального масштабирования: в зависимости от нагрузки на эту часть системы, можно будет поднять несколько копий микросервиса и выполнить работу за приемлемое время. Также это скорее всего поможет снять нагрузку с MES, сделав ее отзывчивее для работы операторов.

3. Работы по уменьшению связности онлайн-магазина и CRM в свете совместного владения данными базы ShopDB. Может подойти как простое решение с использованием CRM в качестве сервиса-делегата (только он будет владеть данными и осуществлять чтение/запись в БД), так и более сложное c разделением базы ShopDB на независимые для каждого сервиса (паттерн Database Per Service) и согласованными изменениями состояния заказов с помощью саг (через хореографию с использованием уже внедренного менеджера очередь RabbitMQ). Также может подойти применение паттерна CQRS, когда онлайн-магазин будет отображать данные из реплики, оптимизированной на чтение, а запись будет осуществляться только через CRM.
Работы по этому направлению позволят добиться стабильности работы онлайн-магазина, помогут решить проблемы охвата большого кол-ва покупателей в будущем и стабильности работы магазина под нагрузкой.

4. Переработка представления заказов в MES для удобства операторов. Внедрение удобных фильтров, ускоряющих работу операторов (сокращающих время ожидания заказа в состоянии MANUFACTURING_APPROVED).

# Система через полгода

Систему нужно подготовить к будущим нагрузкам. Одним из важных аспектов для выявления проблемных мест в сложной распределенной системе - улучшить ее наблюдаемость через внедрение метрик, системы логирования и трейсинг. 

Также имеет смысл озаботиться возможностью горизонтального масштабирования - в текущей архитектуре каждая подсистема запущена в единственном экземпляре. Через полгода хотелось бы иметь возможность запускать некоторые части системы в большем количестве экземпляров, в зависимости от нагрузки.